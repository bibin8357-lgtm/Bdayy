<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An Infinite Birthday Masterpiece</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Montserrat:wght@300;600&display=swap" rel="stylesheet">
    <style>
        /* STYLING ARCHITECTURE (Lines 15-450) 
           This section handles the complex 3D lighting and environmental beauty.
        */
        :root {
            --primary: #ff758c;
            --secondary: #ff7eb3;
            --cake-base: #f3e5ab;
            --frosting: #ffffff;
            --gold: #ffd700;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            overflow: hidden; background: #0a0a0a;
            font-family: 'Montserrat', sans-serif;
            color: white; perspective: 1500px;
        }

        /* The Animated Starfield */
        #canvas-bg { position: fixed; top: 0; left: 0; z-index: -1; }

        /* Stage Setup */
        .world {
            height: 100vh; width: 100vw;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            transform-style: preserve-3d;
        }

        /* --- THE CAKE MASTERPIECE --- */
        .cake-container {
            position: relative; width: 300px; height: 400px;
            transform-style: preserve-3d;
            cursor: pointer; transition: transform 0.5s ease;
        }

        .cake-container:hover { transform: scale(1.05) rotateY(10deg); }

        .tier {
            position: absolute; left: 50%; transform: translateX(-50%);
            background: var(--cake-base); border-radius: 50%;
            box-shadow: inset 0 -15px 30px rgba(0,0,0,0.2), 0 10px 30px rgba(0,0,0,0.5);
        }

        .tier-1 { width: 280px; height: 120px; bottom: 0; z-index: 1; }
        .tier-2 { width: 200px; height: 100px; bottom: 80px; z-index: 2; background: #ffccd5; }
        .tier-3 { width: 140px; height: 80px; bottom: 150px; z-index: 3; background: #ff8fa3; }

        /* Realistic Dripping Frosting */
        .drip-container { position: absolute; width: 100%; height: 100%; top: 20px; }
        .drip {
            position: absolute; width: 15px; height: 40px;
            background: white; border-radius: 20px;
            animation: drip-move 3s infinite alternate ease-in-out;
        }

        /* The Candle & Interactive Flame */
        .candle {
            position: absolute; width: 10px; height: 60px;
            background: linear-gradient(to right, #fff, #f0f0f0);
            bottom: 220px; left: 145px; z-index: 10; border-radius: 5px;
        }

        .flame {
            width: 18px; height: 28px; background: #ff9d00;
            position: absolute; top: -30px; left: -4px;
            border-radius: 50% 50% 20% 20%;
            filter: blur(1px); box-shadow: 0 0 20px #ff5e00, 0 0 40px #ff9d00;
            animation: flicker 0.1s infinite alternate;
        }

        /* --- OVERLAY TEXT --- */
        .instructions {
            position: absolute; bottom: 10%; text-align: center;
            width: 100%; opacity: 0.8; letter-spacing: 3px;
            font-size: 0.8rem; pointer-events: none;
        }

        .main-title {
            font-family: 'Dancing Script', cursive;
            font-size: 4rem; color: var(--gold);
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            margin-top: -100px; opacity: 0;
            transform: translateY(20px); transition: all 2s ease;
        }

        /* Animations (Lines 451-600) */
        @keyframes flicker {
            0% { transform: scale(1) rotate(-1deg); }
            100% { transform: scale(1.1) rotate(1deg); }
        }
        @keyframes drip-move {
            0% { transform: translateY(0); }
            100% { transform: translateY(15px); }
        }

        .shatter-piece {
            position: absolute; pointer-events: none;
            transition: all 1.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
    </style>
</head>
<body>

    <canvas id="canvas-bg"></canvas>

    <div class="world">
        <h1 id="bday-text" class="main-title">Happy Birthday, Beautiful!</h1>
        
        <div class="cake-container" id="master-cake" onclick="handleInteraction()">
            <div id="candle-unit" class="candle">
                <div id="flame-unit" class="flame"></div>
            </div>
            <div class="tier tier-3">
                <div class="drip" style="left:20px; height:30px"></div>
                <div class="drip" style="left:60px; height:45px; animation-delay:0.2s"></div>
                <div class="drip" style="left:100px; height:35px; animation-delay:0.4s"></div>
            </div>
            <div class="tier tier-2"></div>
            <div class="tier tier-1"></div>
        </div>

        <div class="instructions" id="hint">TOUCH THE FLAME TO MAKE A WISH</div>
    </div>

    <script>
        /* LOGIC ENGINE (Lines 600-1100+)
           This creates the "Shocking" interactive elements.
        */

        const canvas = document.getElementById('canvas-bg');
        const ctx = canvas.getContext('2d');
        let particles = [];
        let interactionStep = 0;

        // Initialize Background
        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Starfield Engine
        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2;
                this.speed = Math.random() * 0.5;
            }
            draw() {
                ctx.fillStyle = "rgba(255, 255, 255, 0.8)";
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
            update() {
                this.y -= this.speed;
                if (this.y < 0) this.y = canvas.height;
            }
        }

        const stars = Array.from({ length: 150 }, () => new Star());

        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            stars.forEach(s => { s.update(); s.draw(); });
            requestAnimationFrame(animate);
        }
        animate();

        // --- INTERACTION LOGIC ---
        function handleInteraction() {
            if (interactionStep === 0) {
                blowCandle();
            } else if (interactionStep === 1) {
                shatterCake();
            }
        }

        function blowCandle() {
            document.getElementById('flame-unit').style.display = 'none';
            document.getElementById('hint').innerText = "THE WISH IS MADE. TOUCH THE CAKE TO CUT IT!";
            document.getElementById('hint').style.color = "#ffd700";
            
            // Smoke effect
            createExplosion(window.innerWidth/2, window.innerHeight/2 - 50, '#ffffff', 40);
            interactionStep = 1;
        }

        function shatterCake() {
            const cake = document.getElementById('master-cake');
            const rect = cake.getBoundingClientRect();
            
            cake.style.opacity = '0';
            document.getElementById('hint').style.display = 'none';
            document.getElementById('bday-text').style.opacity = '1';
            document.getElementById('bday-text').style.transform = 'translateY(0)';

            // Create 100 colorful shards
            const colors = ['#ff758c', '#ff7eb3', '#f3e5ab', '#ffffff', '#ffd700'];
            for(let i=0; i<120; i++) {
                const shard = document.createElement('div');
                shard.className = 'shatter-piece';
                shard.style.width = Math.random() * 30 + 'px';
                shard.style.height = Math.random() * 30 + 'px';
                shard.style.background = colors[Math.floor(Math.random()*colors.length)];
                shard.style.left = (rect.left + rect.width/2) + 'px';
                shard.style.top = (rect.top + rect.height/2) + 'px';
                shard.style.borderRadius = Math.random() > 0.5 ? '50%' : '4px';
                document.body.appendChild(shard);

                const angle = Math.random() * Math.PI * 2;
                const dist = 400 + Math.random() * 600;
                const x = Math.cos(angle) * dist;
                const y = Math.sin(angle) * dist;

                setTimeout(() => {
                    shard.style.transform = `translate(${x}px, ${y}px) rotate(${Math.random()*1000}deg) scale(0)`;
                    shard.style.opacity = '0';
                }, 50);
            }
            
            // Final Finale: Confetti Rain
            startConfetti();
        }

        function createExplosion(x, y, color, count) {
            // Particle logic for smoke/embers
            for (let i = 0; i < count; i++) {
                const p = document.createElement('div');
                p.style.position = 'fixed';
                p.style.left = x + 'px'; p.style.top = y + 'px';
                p.style.width = '4px'; p.style.height = '4px';
                p.style.background = color; p.style.borderRadius = '50%';
                document.body.appendChild(p);
                
                p.animate([
                    { opacity: 1, transform: 'translate(0,0)' },
                    { opacity: 0, transform: `translate(${(Math.random()-0.5)*200}px, ${-Math.random()*200}px)` }
                ], { duration: 2000 }).onfinish = () => p.remove();
            }
        }

        function startConfetti() {
            setInterval(() => {
                createExplosion(Math.random()*window.innerWidth, Math.random()*window.innerHeight, `hsl(${Math.random()*360}, 100%, 70%)`, 10);
            }, 300);
        }
    </script>
</body>
</html>
